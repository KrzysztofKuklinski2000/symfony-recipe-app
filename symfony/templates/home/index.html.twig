{% extends "base.html.twig" %}

{% import '_macros/icons.html.twig' as icons %}

{% block title %}
{{ currentCategory ? 'Kategoria: ' ~ currentCategory.name : "Przepisy" }}
{% endblock %}

{% block body %}
<br>
{% include "home/_search.html.twig" %}

<div class="container mx-auto px-4 max-w-7xl">
    <div class="flex flex-col md:flex-row items-center justify-between gap-4 mb-6 border-b border-gray-200 pb-4">

        {# --- PAGE TITLE --- #}
        <div class="flex items-center gap-3">
            <span class="text-gray-400 hidden md:block">{{ icons.list(6) }}</span>
            <h1 class="text-2xl font-bold text-gray-800">
                {% if currentCategory %}
                Kategoria: <span class="text-blue-600">{{ currentCategory.name }}</span>
                <a href="{{ path('app_home') }}"
                    class="ml-2 text-xs font-normal text-gray-400 hover:text-red-500 hover:underline transition-colors"
                    title="Usuń filtr kategorii">
                    (Wyczyść)
                </a>
                {% else %}
                Wszystkie Przepisy
                {% endif %}
            </h1>
        </div>

        {# --- CATEGORY DROPDOWN --- #}
        <div class="relative group z-20">
            <button
                class="flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 rounded-lg shadow-sm hover:bg-gray-50 transition text-sm font-medium text-gray-700"
                id='category-button'>
                {{ icons.filter(4) }}
                <span>Wybierz kategorię</span>
            </button>

            {# Dropdown menu (visible on hover/focus) #}
            <ul
                class="absolute right-0 mt-2 w-48 bg-white border border-gray-200 rounded-lg shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 transform origin-top-right overflow-hidden">
                {% for category in categories %}
                <li>
                    <a href="{{ path('app_home_category', {'slug': category.slug }) }}"
                        class="block px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition-colors">
                        {{ category.name }}
                    </a>
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>

    {# --- RECIPE LIST --- #}
    <div>
        {% include "recipe/_list.html.twig" with { "recipes": recipes } %}
    </div>

    {# --- LOAD MORE --- #}
    {% include "home/_load_more_btn.html.twig" with {
            'hasNextPage': hasNextPage,
            'page': page,
            'category': currentCategory|default(null),
        } %}
</div>
{% endblock %}
